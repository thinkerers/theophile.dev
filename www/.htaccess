RewriteEngine On
RewriteBase /

# Force HTTPS (Redirect all HTTP traffic to HTTPS)
RewriteCond %{HTTPS} !on
RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

# Check if the request is trying to access a folder outside of /public
RewriteCond %{REQUEST_URI} !^/public/
RewriteRule ^(.*)$ /public/index.php [L]

# Check if the request is for an existing file or directory within /public
RewriteCond %{REQUEST_FILENAME} -f [OR]
RewriteCond %{REQUEST_FILENAME} -d
RewriteRule ^public/ - [L]

# Redirect all other requests to /public/index.php
RewriteRule ^public/.*$ /public/index.php [L]

# Custom error page
ErrorDocument 500 /public/error.php

<IfModule mod_headers.c>
    AddDefaultCharset UTF-8

    Header set X-Content-Type-Options "nosniff"

    Header set Content-Security-Policy "default-src 'none';base-uri 'self';form-action 'self';frame-ancestors 'self';object-src 'none';script-src 'self';style-src 'self';img-src 'self';"

    Header set Referrer-Policy "strict-origin-when-cross-origin"

    Header set Cross-Origin-Embedder-Policy "require-corp"

    Header set Cross-Origin-Opener-Policy "same-origin"

    Header set Cross-Origin-Resource-Policy "same-origin"
    
    # Cache static assets for 1 year
    <FilesMatch "\.(jpg|jpeg|png|gif|svg|css|js|woff|woff2|ttf|eot)$">
        Header set Cache-Control "max-age=31536000, public, immutable"
    </FilesMatch>

    # Cache HTML for 1 hour
    <FilesMatch "\.html$">
        Header set Cache-Control "max-age=3600, public"
    </FilesMatch>
</IfModule>